var fs=require("fs"),path=require("path"),test=require("tape"),resolve=require("../");test("$NODE_PATH",(function(t){t.plan(8);var isDir=function(dir,cb){if("/node_path"===dir||"node_path/x"===dir)return cb(null,!0);fs.stat(dir,(function(err,stat){return err?"ENOENT"===err.code||"ENOTDIR"===err.code?cb(null,!1):cb(err):cb(null,stat.isDirectory())}))};resolve("aaa",{paths:[path.join(__dirname,"/node_path/x"),path.join(__dirname,"/node_path/y")],basedir:__dirname,isDirectory:isDir},(function(err,res){t.error(err),t.equal(res,path.join(__dirname,"/node_path/x/aaa/index.js"),"aaa resolves")})),resolve("bbb",{paths:[path.join(__dirname,"/node_path/x"),path.join(__dirname,"/node_path/y")],basedir:__dirname,isDirectory:isDir},(function(err,res){t.error(err),t.equal(res,path.join(__dirname,"/node_path/y/bbb/index.js"),"bbb resolves")})),resolve("ccc",{paths:[path.join(__dirname,"/node_path/x"),path.join(__dirname,"/node_path/y")],basedir:__dirname,isDirectory:isDir},(function(err,res){t.error(err),t.equal(res,path.join(__dirname,"/node_path/x/ccc/index.js"),"ccc resolves")})),resolve("tap",{paths:["node_path"],basedir:path.join(__dirname,"node_path/x"),isDirectory:isDir},(function(err,res){var root=require("tap/package.json").main;t.error(err),t.equal(res,path.resolve(__dirname,"..","node_modules/tap",root),"tap resolves")}))}));