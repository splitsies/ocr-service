var path=require("path"),parse=path.parse||require("path-parse"),getNodeModulesDirs=function(absoluteStart,modules){var prefix="/";/^([A-Za-z]:)/.test(absoluteStart)?prefix="":/^\\\\/.test(absoluteStart)&&(prefix="\\\\");for(var paths=[absoluteStart],parsed=parse(absoluteStart);parsed.dir!==paths[paths.length-1];)paths.push(parsed.dir),parsed=parse(parsed.dir);return paths.reduce((function(dirs,aPath){return dirs.concat(modules.map((function(moduleDir){return path.resolve(prefix,aPath,moduleDir)})))}),[])};module.exports=function(start,opts,request){var modules=opts&&opts.moduleDirectory?[].concat(opts.moduleDirectory):["node_modules"];if(opts&&"function"==typeof opts.paths)return opts.paths(request,start,(function(){return getNodeModulesDirs(start,modules)}),opts);var dirs=getNodeModulesDirs(start,modules);return opts&&opts.paths?dirs.concat(opts.paths):dirs};