Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=populatePlaceholders;var _t=require("@babel/types");const{blockStatement:blockStatement,cloneNode:cloneNode,emptyStatement:emptyStatement,expressionStatement:expressionStatement,identifier:identifier,isStatement:isStatement,isStringLiteral:isStringLiteral,stringLiteral:stringLiteral,validate:validate}=_t;function populatePlaceholders(metadata,replacements){const ast=cloneNode(metadata.ast);return replacements&&(metadata.placeholders.forEach((placeholder=>{if(!Object.prototype.hasOwnProperty.call(replacements,placeholder.name)){const placeholderName=placeholder.name;throw new Error(`Error: No substitution given for "${placeholderName}". If this is not meant to be a\n            placeholder you may want to consider passing one of the following options to @babel/template:\n            - { placeholderPattern: false, placeholderWhitelist: new Set(['${placeholderName}'])}\n            - { placeholderPattern: /^${placeholderName}$/ }`)}})),Object.keys(replacements).forEach((key=>{if(!metadata.placeholderNames.has(key))throw new Error(`Unknown substitution "${key}" given`)}))),metadata.placeholders.slice().reverse().forEach((placeholder=>{try{applyReplacement(placeholder,ast,replacements&&replacements[placeholder.name]||null)}catch(e){throw e.message=`@babel/template placeholder "${placeholder.name}": ${e.message}`,e}})),ast}function applyReplacement(placeholder,ast,replacement){placeholder.isDuplicate&&(Array.isArray(replacement)?replacement=replacement.map((node=>cloneNode(node))):"object"==typeof replacement&&(replacement=cloneNode(replacement)));const{parent:parent,key:key,index:index}=placeholder.resolve(ast);if("string"===placeholder.type){if("string"==typeof replacement&&(replacement=stringLiteral(replacement)),!replacement||!isStringLiteral(replacement))throw new Error("Expected string substitution")}else if("statement"===placeholder.type)void 0===index?replacement?Array.isArray(replacement)?replacement=blockStatement(replacement):"string"==typeof replacement?replacement=expressionStatement(identifier(replacement)):isStatement(replacement)||(replacement=expressionStatement(replacement)):replacement=emptyStatement():replacement&&!Array.isArray(replacement)&&("string"==typeof replacement&&(replacement=identifier(replacement)),isStatement(replacement)||(replacement=expressionStatement(replacement)));else if("param"===placeholder.type){if("string"==typeof replacement&&(replacement=identifier(replacement)),void 0===index)throw new Error("Assertion failure.")}else if("string"==typeof replacement&&(replacement=identifier(replacement)),Array.isArray(replacement))throw new Error("Cannot replace single expression with an array.");if(void 0===index)validate(parent,key,replacement),parent[key]=replacement;else{const items=parent[key].slice();"statement"===placeholder.type||"param"===placeholder.type?null==replacement?items.splice(index,1):Array.isArray(replacement)?items.splice(index,1,...replacement):items[index]=replacement:items[index]=replacement,validate(parent,key,items),parent[key]=items}}