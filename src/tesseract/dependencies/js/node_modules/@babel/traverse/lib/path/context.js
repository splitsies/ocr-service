Object.defineProperty(exports,"__esModule",{value:!0}),exports._call=_call,exports._getQueueContexts=_getQueueContexts,exports._resyncKey=_resyncKey,exports._resyncList=_resyncList,exports._resyncParent=_resyncParent,exports._resyncRemoved=_resyncRemoved,exports.call=call,exports.isBlacklisted=exports.isDenylisted=isDenylisted,exports.popContext=popContext,exports.pushContext=pushContext,exports.requeue=requeue,exports.resync=resync,exports.setContext=setContext,exports.setKey=setKey,exports.setScope=setScope,exports.setup=setup,exports.skip=skip,exports.skipKey=skipKey,exports.stop=stop,exports.visit=visit;var _traverseNode=require("../traverse-node"),_index=require("./index");function call(key){const opts=this.opts;return this.debug(key),!(!this.node||!this._call(opts[key]))||!!this.node&&this._call(opts[this.node.type]&&opts[this.node.type][key])}function _call(fns){if(!fns)return!1;for(const fn of fns){if(!fn)continue;const node=this.node;if(!node)return!0;const ret=fn.call(this.state,this,this.state);if(ret&&"object"==typeof ret&&"function"==typeof ret.then)throw new Error("You appear to be using a plugin with an async traversal visitor, which your current version of Babel does not support. If you're using a published plugin, you may need to upgrade your @babel/core version.");if(ret)throw new Error(`Unexpected return value from visitor method ${fn}`);if(this.node!==node)return!0;if(this._traverseFlags>0)return!0}return!1}function isDenylisted(){var _this$opts$denylist;const denylist=null!=(_this$opts$denylist=this.opts.denylist)?_this$opts$denylist:this.opts.blacklist;return denylist&&denylist.indexOf(this.node.type)>-1}function restoreContext(path,context){path.context!==context&&(path.context=context,path.state=context.state,path.opts=context.opts)}function visit(){var _this$opts$shouldSkip,_this$opts;if(!this.node)return!1;if(this.isDenylisted())return!1;if(null!=(_this$opts$shouldSkip=(_this$opts=this.opts).shouldSkip)&&_this$opts$shouldSkip.call(_this$opts,this))return!1;const currentContext=this.context;return this.shouldSkip||this.call("enter")?(this.debug("Skip..."),this.shouldStop):(restoreContext(this,currentContext),this.debug("Recursing into..."),this.shouldStop=(0,_traverseNode.traverseNode)(this.node,this.opts,this.scope,this.state,this,this.skipKeys),restoreContext(this,currentContext),this.call("exit"),this.shouldStop)}function skip(){this.shouldSkip=!0}function skipKey(key){null==this.skipKeys&&(this.skipKeys={}),this.skipKeys[key]=!0}function stop(){this._traverseFlags|=_index.SHOULD_SKIP|_index.SHOULD_STOP}function setScope(){var _this$opts2,_this$scope;if(null!=(_this$opts2=this.opts)&&_this$opts2.noScope)return;let target,path=this.parentPath;for((("key"===this.key||"decorators"===this.listKey)&&path.isMethod()||"discriminant"===this.key&&path.isSwitchStatement())&&(path=path.parentPath);path&&!target;){var _path$opts;if(null!=(_path$opts=path.opts)&&_path$opts.noScope)return;target=path.scope,path=path.parentPath}this.scope=this.getScope(target),null==(_this$scope=this.scope)||_this$scope.init()}function setContext(context){return null!=this.skipKeys&&(this.skipKeys={}),this._traverseFlags=0,context&&(this.context=context,this.state=context.state,this.opts=context.opts),this.setScope(),this}function resync(){this.removed||(this._resyncParent(),this._resyncList(),this._resyncKey())}function _resyncParent(){this.parentPath&&(this.parent=this.parentPath.node)}function _resyncKey(){if(this.container&&this.node!==this.container[this.key]){if(Array.isArray(this.container)){for(let i=0;i<this.container.length;i++)if(this.container[i]===this.node)return void this.setKey(i)}else for(const key of Object.keys(this.container))if(this.container[key]===this.node)return void this.setKey(key);this.key=null}}function _resyncList(){if(!this.parent||!this.inList)return;const newContainer=this.parent[this.listKey];this.container!==newContainer&&(this.container=newContainer||null)}function _resyncRemoved(){null!=this.key&&this.container&&this.container[this.key]===this.node||this._markRemoved()}function popContext(){this.contexts.pop(),this.contexts.length>0?this.setContext(this.contexts[this.contexts.length-1]):this.setContext(void 0)}function pushContext(context){this.contexts.push(context),this.setContext(context)}function setup(parentPath,container,listKey,key){this.listKey=listKey,this.container=container,this.parentPath=parentPath||this.parentPath,this.setKey(key)}function setKey(key){var _this$node;this.key=key,this.node=this.container[this.key],this.type=null==(_this$node=this.node)?void 0:_this$node.type}function requeue(pathToQueue=this){if(pathToQueue.removed)return;const contexts=this.contexts;for(const context of contexts)context.maybeQueue(pathToQueue)}function _getQueueContexts(){let path=this,contexts=this.contexts;for(;!contexts.length&&(path=path.parentPath,path);)contexts=path.contexts;return contexts}